<!DOCTYPE html>
{% extends "base.html" %}
{% load static %}
{% load custom_filters %}
<html lang="ko">
<head>
    <title>
        {% block title %}
            {% if keyword == 'Generative' %}
                ìƒì„± ë™í™”
            {% elif keyword == 'ê·¸ë¦¼í˜•ì œ' %}
                ê·¸ë¦¼í˜•ì œ
            {% elif keyword == 'ì´ì†ìš°í™”' %}
                ì´ì†ìš°í™”
            {% elif keyword == 'ì „ë˜ë™í™”' %}
                ì „ë˜ë™í™”
            {% elif keyword == 'ìƒ¤ë¥¼í˜ë¡œ' %}
                ìƒ¤ë¥¼í˜ë¡œ
            {% else %}
                ê²€ìƒ‰ ê²°ê³¼
            {% endif %}
    </title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'css/search_results.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>{% endblock %}
{% block content %}
<body>
    <div id="preloader">
        <div id="curtain-left" class="curtain"></div>
        <div id="curtain-right" class="curtain"></div>
    </div>
    <div class="search-results-container">
        <h1 class='h'>
            {% if keyword == 'Generative' %}
                ğŸ“š ìƒì„± ë™í™”
            {% elif keyword == 'ê·¸ë¦¼í˜•ì œ' %}
                ğŸ“˜ ê·¸ë¦¼í˜•ì œ
            {% elif keyword == 'ì´ì†ìš°í™”' %}
                ğŸ“• ì´ì†ìš°í™”
            {% elif keyword == 'ì „ë˜ë™í™”' %}
                ğŸ“— ì „ë˜ë™í™”
            {% elif keyword == 'ìƒ¤ë¥¼í˜ë¡œ' %}
                ğŸ“™ ìƒ¤ë¥¼í˜ë¡œ
            {% else %}
                {% if not no_results %}
                    ğŸ” ê²€ìƒ‰ ê²°ê³¼
                {% else %}
                    ğŸ˜¢ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                {% endif %}
            {% endif %}
        </h1>
        {% if not no_results %}
        <form class="sorted_story" method="GET" action="{% url 'reader:search' %}">
            <input type="hidden" id="keyword" name="keyword" value="{{ keyword }}">
            
            <label class="sorted_method" for="options">[ ì •ë ¬ ë°©ë²• ì„ íƒ ]</label>
            <select id="options" name="options" onchange="this.form.submit()">
                <option value="high-rating" {% if selected_option == 'high-rating' %}selected{% endif %}>ë³„ì  ë†’ì€ ìˆœ</option>
                <option value="low-rating" {% if selected_option == 'low-rating' %}selected{% endif %}>ë³„ì  ë‚®ì€ ìˆœ</option>
                <option value="name" {% if selected_option == 'name' %}selected{% endif %}>ì´ë¦„ ìˆœ</option>
                <option value="random" {% if selected_option == 'random' %}selected{% endif %}>ëœë¤ ìˆœ</option>
            </select>
        </form>
        {% endif %}
        <div class="books">
            <ul class="gallery">
                {% for story in stories %}
                <li class='book container1'>
                    <div class="overlay"></div>
                    {% comment %} <a class='link-click-animation' href="{% url 'reader:story_detail' story.id %}?keyword={{ keyword }}"> {% endcomment %}
                    <a class='link-click-animation' 
                        href=
                            "{% if keyword == 'Generative' %}
                                {% url 'reader:genstory_detail' story.id %}?keyword={{ keyword }}
                            {% else %}
                                {% url 'reader:story_detail' story.id %}?keyword={{ keyword }}
                            {% endif %}">
                        {% if story.image %}
                        <img class="card" src="{{ story.image.url }}" alt="{{ story.title }}">
                        {% elif story.thumbnail %}
                        <img class="card" src="{{ story.thumbnail.url }}" alt="{{ story.title }}">
                        {% else %}
                        <img class="card" src="{% static 'images/ìƒì.png' %}" alt="{{ story.title }}">
                        {% endif %}
                        <span class="book-title">{{ story.title }}</span>
                    </a>
                    <div class="star-rating">
                        {% for i in 5|to_range %}
                        <div class="star {% if i <= story.starpoint %}full{% endif %}"></div>
                        {% endfor %}
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <script>
     $(document).ready(function() {
            $('.link-click-animation').on('click', function(e) {
                e.preventDefault();

                var targetUrl = $(this).attr('href');
                if (!targetUrl.endsWith("?keyword=Generative")) { // ìƒì„± ë™í™”ëŠ” ì»¤íŠ¼ í•„ìš” ì—†ìŒ
                    // í”„ë¦¬ë¡œë” ë³´ì´ê¸°
                    $('#preloader').show();
                }

                // ì‹¤ì œ í˜ì´ì§€ë¡œ ì´ë™
                var targetUrl = $(this).attr('href');
                
                setTimeout(function() {
                    window.location.href = targetUrl;
                }, 1000);
            });
        });
        $(window).on('pageshow', function(event) {
            console.log('ë’¤ë¡œê°€ê¸° ì´ë²¤íŠ¸ ë°œìƒ');
            preloader.style.display = 'none';
        });
        var containers = document.querySelectorAll('.container1');
        containers.forEach(function(container) {
            var overlay = container.querySelector('.overlay');
            var timeout;

            container.addEventListener('mousemove', function(e) {
                var x = e.offsetX;
                var y = e.offsetY;
                var rotateY = -1 / 5 * x + 20;
                var rotateX = 4 / 30 * y - 20;

                overlay.style.backgroundPosition = `${x / 5 + y / 5}%`;
                overlay.style.filter = `opacity(${x / 200}) brightness(1.2)`;

                container.style.transition = 'transform 0.1s ease';
                container.style.transform = `perspective(350px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;

                clearTimeout(timeout);
            });

            container.addEventListener('mouseout', function() {
                overlay.style.filter = 'opacity(0)';
                timeout = setTimeout(function() {
                    container.style.transition = 'transform 0.1s ease';
                    container.style.transform = 'perspective(350px) rotateY(0deg) rotateX(0deg)';
                }, 150);
            });
        });
    </script>
</body>
</html>
{% endblock %}
